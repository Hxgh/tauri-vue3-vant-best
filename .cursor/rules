# 项目架构规则

## 核心模块 (src/core/)

| 模块 | 路径 | 说明 |
|------|------|------|
| platform | `@/core/platform` | 平台检测、原生桥接、日志 |
| theme | `@/core/theme` | 主题系统 |
| layout | `@/core/layout` | 布局系统 |
| scanner | `@/core/scanner` | 扫码功能 |
| map | `@/core/map` | 地图导航 |
| notification | `@/core/notification` | 系统通知 |

## 布局系统

### 4 种模式

| 模式 | 配置 | 示例 |
|------|------|------|
| 标准页面 | `Standard` + `BelowHeader` + `Standard` | Page2 |
| 无 Header | `None` + `SafeArea` + `Standard` | Page3 |
| 详情页 | `Standard` + `BelowHeader` + `None` | DetailPage |
| 沉浸式 | `None` + `ScreenTop` + `Immersive` | LoginPage |

### 工具组件

- **FixedBottom** - 固定底部按钮（有背景）
- **ImmersiveNavbar** - 沉浸式顶部导航栏
- **ImmersiveBottomBar** - 沉浸式底部控制栏

---

## 主题系统

```typescript
import { useThemeStore } from '@/core/theme';

themeStore.setMode('auto');   // 跟随系统
themeStore.setMode('dark');   // 强制深色
themeStore.setMode('light');  // 强制浅色
```

### 原生双向同步

- **Web → Android**: `window.AndroidTheme.setTheme(theme, mode)`
- **Web → iOS**: `window.webkit.messageHandlers.iOSTheme.postMessage(...)`
- **原生 → Web**: 注入 `window.__ANDROID_SYSTEM_THEME__` / `window.__IOS_SYSTEM_THEME__`

---

## 代码规范

- 使用 `@/core/` 导入核心模块
- 使用 `logger` 代替 `console.log`
- Vue: Composition API + `<script setup>` + TypeScript
- 枚举: PascalCase（如 `HeaderMode.Standard`）

---

## 关键文件

| 文件 | 说明 |
|------|------|
| `src/core/layout/MainLayout.vue` | 统一布局管理 |
| `src/core/theme/store.ts` | 主题状态管理 |
| `src/core/theme/styles/theme.css` | 主题 CSS 变量 |
| `src-tauri/src/lib.rs` | Tauri 命令 |
| `scripts/build-android.sh` | 构建脚本 |

---

## 构建命令

```bash
pnpm dev                    # 开发服务器
pnpm build                  # 生产构建
pnpm build:android:dev      # Android 开发
pnpm build:android:prod     # Android 生产
pnpm lint                   # 代码检查
pnpm check                  # 检查并修复
```
